#include "digits.h"
#include "../controllers/video/graphics.h"

static const uint8_t digit_patterns[10][7] = {
    // 0
    {0x0E, 0x11, 0x11,0x11,0x11,0x11,0x0E},
    // 1
    {0x04,0x0C,0x04,0x04,0x04,0x04,0x0E},
    // 2
    {0x0E,0x11,0x01,0x02,0x04,0x08,0x1F},
    // 3
    {0x0E,0x11,0x01,0x06,0x01,0x11,0x0E},
    // 4
    {0x02,0x06,0x0A,0x12,0x1F,0x02,0x02},
    // 5
    {0x1F,0x10,0x10,0x1E,0x01,0x11,0x0E},
    // 6
    {0x0E,0x11,0x10,0x1E,0x11,0x11,0x0E},
    // 7
    {0x1F, 0x01, 0x02,0x04,0x08,0x08,0x08},
    // 8
    {0x0E,0x11,0x11,0x0E,0x11,0x11,0x0E},
    // 9
    {0x0E,0x11,0x11,0x0F,0x01,0x11,0x0E}
};

static const uint8_t letter_patterns[26][7] = {
    // A
    {0x0E,0x11,0x11,0x1F,0x11,0x11,0x11},
    // B
    {0x1E,0x11,0x11,0x1E,0x11,0x11,0x1E},
    // C
    {0x0E,0x11,0x10,0x10,0x10,0x11,0x0E},
    // D
    {0x1E,0x11,0x11,0x11,0x11,0x11,0x1E},
    // E
    {0x1F,0x10,0x10,0x1E,0x10,0x10,0x1F},
    // F
    {0x1F,0x10,0x10,0x1E,0x10,0x10,0x10},
    // G
    {0x0E,0x11,0x10,0x17,0x11,0x11,0x0E},
    // H
    {0x11,0x11,0x11,0x1F,0x11,0x11,0x11},
    // I
    {0x0E,0x04,0x04,0x04,0x04,0x04,0x0E},
    // J
    {0x07,0x02,0x02,0x02,0x02,0x12,0x0C},
    // K
    {0x11,0x12,0x14,0x18,0x14,0x12,0x11},
    // L
    {0x10,0x10,0x10,0x10,0x10,0x10,0x1F},
    // M
    {0x11,0x1B,0x15,0x15,0x11,0x11,0x11},
    // N
    {0x11,0x19,0x15,0x13,0x11,0x11,0x11},
    // O
    {0x0E,0x11,0x11,0x11,0x11,0x11,0x0E},
    // P
    {0x1E,0x11,0x11,0x1E,0x10,0x10,0x10},
    // Q
    {0x0E,0x11,0x11,0x11,0x15,0x12,0x0D},
    // R
    {0x1E,0x11,0x11,0x1E,0x14,0x12,0x11},
    // S
    {0x0E,0x11,0x10,0x0E,0x01,0x11,0x0E},
    // T
    {0x1F,0x04,0x04,0x04,0x04,0x04,0x04},
    // U
    {0x11,0x11,0x11,0x11,0x11,0x11,0x0E},
    // V
    {0x11,0x11,0x11,0x11,0x11,0x0A,0x04},
    // W
    {0x11,0x11,0x11,0x15,0x15,0x1B,0x11},
    // X
    {0x11,0x11,0x0A,0x04,0x0A,0x11,0x11},
    // Y
    {0x11,0x11,0x11,0x0A,0x04,0x04,0x04},
    // Z
    {0x1F,0x01,0x02,0x04,0x08,0x10,0x1F}
};

void draw_digit(int x, int y, int digit, uint32_t color) {
    if (digit < 0 || digit > 9) return;
    
    for (int row = 0; row < 7; row++) {
        uint8_t pattern = digit_patterns[digit][row];
        for (int col = 0; col < 5; col++) {
            if (pattern & (1 << (4 - col))) {
                vg_draw_rectangle(x + col * 2, y + row * 2, 2, 2, color);
            }
        }
    }
}

void draw_letter(int x, int y, char letter, uint32_t color) {
    if (letter < 'A' || letter > 'Z') return;
    
    int index = letter - 'A';
    for (int row = 0; row < 7; row++) {
        uint8_t pattern = letter_patterns[index][row];
        for (int col = 0; col < 5; col++) {
            if (pattern & (1 << (4 - col))) {
                vg_draw_rectangle(x + col * 2, y + row * 2, 2, 2, color);
            }
        }
    }
}

void draw_text(int x, int y, const char* text, uint32_t color) {
    int current_x = x;
    for (int i = 0; text[i] != '\0'; i++) {
        char c = text[i];
        if (c >= 'A' && c <= 'Z') {
            draw_letter(current_x, y, c, color);
        } else if (c >= 'a' && c <= 'z') {
            draw_letter(current_x, y, c - 'a' + 'A', color);
        } else if (c >= '0' && c <= '9') {
            draw_digit(current_x, y, c - '0', color);
        } else if (c == ' ') {
        }
        current_x += 12;
    }
}

void draw_number(int x, int y, int number, uint32_t color) {
    if (number == 0) {
        draw_digit(x, y, 0, color);
        return;
    }
    
    int temp = number;
    int digit_count = 0;
    while (temp > 0) {
        digit_count++;
        temp /= 10;
    }
    
    int current_x = x + (digit_count - 1) * 12;
    while (number > 0) {
        int digit = number % 10;
        draw_digit(current_x, y, digit, color);
        number /= 10;
        current_x -= 12;
    }
}
